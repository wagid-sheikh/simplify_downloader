<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      body {
        font-family: "Inter", "Helvetica", Arial, sans-serif;
        margin: 24px;
        color: #222;
      }
      h1 {
        font-size: 22px;
        margin-bottom: 4px;
      }
      h2 {
        font-size: 18px;
        margin-top: 24px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
        font-size: 12px;
      }
      th {
        background: #f7f7f7;
      }
      .missing {
        color: #b00;
        font-weight: bold;
      }
      .meta {
        font-size: 12px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <h1>{{ title }}</h1>
    <div class="meta">
      <div>Store: {{ store_code }}</div>
      <div>Period: {{ period_label }}</div>
      <div>Generated at: {{ generated_at }}</div>
    </div>

    {% if missing %}
    <p class="missing">
      No dashboard data was found for this period. Please confirm the daily pipeline
      has ingested data for this store.
    </p>
    {% else %}
    <table>
      <thead>
        <tr>
          <th>Metric</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Dashboard days ingested</td>
          <td>{{ stats.row_count or 0 }}</td>
        </tr>
        <tr>
          <td>Pickup total orders</td>
          <td>{{ stats.pickup_total or 0 }}</td>
        </tr>
        <tr>
          <td>Avg delivery TAT %</td>
          <td>{{ stats.avg_delivery_tat or 0 | round(2) }}</td>
        </tr>
        <tr>
          <td>Avg repeat base %</td>
          <td>{{ stats.avg_repeat_pct or 0 | round(2) }}</td>
        </tr>
        <tr>
          <td>Avg pickup conversion %</td>
          <td>{{ stats.avg_conversion or 0 | round(2) }}</td>
        </tr>
      </tbody>
    </table>
    {% endif %}

    {% if missing_stores %}
    <h2>Stores without data</h2>
    <p>
      {{ ", ".join(missing_stores) if missing_stores else "None" }}
    </p>
    {% endif %}
  </body>
</html>
